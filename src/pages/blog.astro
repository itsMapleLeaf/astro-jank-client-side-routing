---
import Layout from "../app/layout.astro";

if (Astro.request.method === 'POST') {
	const params = new URLSearchParams(
		Object.fromEntries(await Astro.request.formData())
	);
	params.set('commentSuccess', 'true');
	return Astro.redirect(`/blog?${params.toString()}`);
}

const url = new URL(Astro.request.url);
const commentSuccess = url.searchParams.get('commentSuccess');
const name = url.searchParams.get('name');
const comment = url.searchParams.get('comment');
---

<Layout title="blog">
	<p>add a comment</p>

	<form method="post" style="display: grid; gap: 0.5rem; justify-items: flex-start;">
		<label>
			<div>name</div>
			<input type="text" name="name" placeholder="your name" />
			<script type="module">
				window.addEventListener('router:ready', () => {
					document.querySelector('input[name="name"]')?.focus()
				})
			</script>
		</label>
		<label>
			<div>comment</div>
			<textarea name="comment" placeholder="say something nice!" rows={4} cols={50} />
		</label>
		<button type="submit">submit</button>
	</form>

	{commentSuccess && (
		<>
		<div style="color: green; font-weight: bold;">
			thanks for your comment, {name}!
		</div>
		<p>
			{comment}</p>
		</>
	)}
</Layout>
